/**
 * Generated PicoMsg TypeScript bindings
 * This file is auto-generated. Do not edit manually.
 * 
 * Schema: {{ namespace or 'default' }}
 * Version: {{ version }}
 */

// Constants
export const {{ const_prefix }}MAGIC_BYTE_1 = 0xAB;
export const {{ const_prefix }}MAGIC_BYTE_2 = 0xCD;
export const {{ const_prefix }}VERSION = {{ version }};
export const {{ const_prefix }}HEADER_SIZE = 8;

// Message type IDs
{% for message_name, type_id in message_type_ids.items() %}
export const {{ const_prefix }}{{ message_name | upper_snake_case }}_TYPE_ID = {{ type_id }};
{% endfor %}

// Error classes
export class {{ error_class }} extends Error {
  constructor(message: string) {
    super(message);
    this.name = this.constructor.name;
  }
}

export class {{ error_class }}InvalidHeader extends {{ error_class }} {}
export class {{ error_class }}BufferTooSmall extends {{ error_class }} {}
export class {{ error_class }}InvalidData extends {{ error_class }} {}

// Base interface
export interface PicoMsgSerializable {
  toBytes(): Uint8Array;
  fromBytes(data: Uint8Array): void;
  toJSON(): any;
  fromJSON(data: any): void;
}

export abstract class {{ base_class }} implements PicoMsgSerializable {
  abstract toBytes(): Uint8Array;
  abstract fromBytes(data: Uint8Array): void;
  abstract toJSON(): any;
  abstract fromJSON(data: any): void;

  static fromBytes<T extends {{ base_class }}>(this: new() => T, data: Uint8Array): T {
    const instance = new this();
    instance.fromBytes(data);
    return instance;
  }

  static fromJSON<T extends {{ base_class }}>(this: new() => T, data: any): T {
    const instance = new this();
    instance.fromJSON(data);
    return instance;
  }

  toBase64(): string {
    const bytes = this.toBytes();
    return btoa(String.fromCharCode(...bytes));
  }

  static fromBase64<T extends {{ base_class }}>(this: new() => T, base64: string): T {
    const binaryString = atob(base64);
    const bytes = new Uint8Array(binaryString.length);
    for (let i = 0; i < binaryString.length; i++) {
      bytes[i] = binaryString.charCodeAt(i);
    }
    const instance = new this();
    instance.fromBytes(bytes);
    return instance;
  }
}

{% for enum in schema.enums %}
export enum {{ namespace_prefix }}{{ enum.name }} {
  {% for value in enum.values %}
  {{ value.name }} = {{ value.value }},
  {% endfor %}
}

{% endfor %}

{% for struct in schema.structs %}
{% include 'typescript/struct.ts.j2' %}

{% endfor %}

{% for message in schema.messages %}
{% include 'typescript/message.ts.j2' %}

{% endfor %} 